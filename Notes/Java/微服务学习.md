[TOC]

# 一、微服务梳理

## 1. 服务描述

类似服务的说明文档，简单但不可或缺。比如，服务调用首先要解决的问题就是服务如何对外描述。比如，你对外提供了一个服务，那么这个服务的服务名叫什么？调用这个服务需要提供哪些信息？调用这个服务返回的结果是什么格式的？该如何解析？这些就是服务描述要解决的问题。

## 2. 注册中心

有了服务的接口描述，下一步要解决的问题就是服务的发布和订阅，就是说你提供了一个服务(Provider)，如何让外部(Consumer)想调用你的服务的人知道。这个时候就需要一个类似注册中心(Registry)的角色，服务提供者将自己提供的服务以及地址登记到注册中心，服务消费者则从注册中心查询所需要调用的服务的地址，然后发起请求。

请求：同步、异步

注册中心、服务提供者、服务消费者、监控者

异步通知和监控

同步invoke

## 3. 服务框架

通过注册中心，服务消费者就可以获取到服务提供者的地址，有了地址后就可以发起调用。但在发起调用之前你还需要解决以下几个问题。服务通信采用什么协议？是RESTful API还是gRPC？数据传输采用什么方式数据压缩采用什么格式？这些活通常集成到了我们的服务框架里面，市面上有[很多这样的开源框架](https://www.cnblogs.com/jackyfei/p/9955108.html)，相对都比较成熟，接下来考验你的是快速上手的能力。

## 4. 服务监控

一旦服务消费者与服务提供者之间能够正常发起服务调用，你就需要对调用情况进行监控，以了解服务是否正常。通常来讲，服务监控主要包括三个流程，指标收集，数据处理，数据展示。监控是为了发现问题和异常，如果要进一步跟踪和定位问题，则需要进一步了解服务追踪。

## 5. 服务追踪

除了需要对服务调用情况进行监控之外，你还需要记录服务调用经过的每一层链路，以便进行问题追踪和故障定位，最后达到接近问题的目的。服务监控和追踪可以合并起来，但是要明确各自的职责是不一样的。

## 6. 服务治理

服务监控能够发现问题，服务追踪能够定位问题所在，而解决问题就得靠服务治理了。服务治理就是通过一系列的手段来保证在各种意外情况下，服务调用仍然能够正常进行。就目前开源的服务框架，大部分都不包括服务治理的内容，所以有可能这块是需要你和你的团队进行定制化开发，就看你做到什么程度了，就好比你有数据库但是你没有ER图描述，并不影响你用微服务，当然如果有就是锦上添花的东西了。

### 1. 服务发现

### 2. 负载均衡

#### 1. nginx（服务器端负载均衡）

#### 2. ribbon（客户端负载均衡）

### 3. 限流

### 4. 熔断

### 5. 超时

### 6. 重试

### 7. 服务追踪



# 二、使用到的工具、技术、框架

## 1. Nginx——服务器端负载均衡

## 2. Ribbon——客户端负载均衡

## 3. Nacos——服务注册中心和配置中心

## 4. Apollo——配置中心（已替换）

## 5. skywalking——服务追踪

## 6. eureka——注册中心（已被替换）

## 7. feign——服务调用

## 8. redis、mongoDB——缓存

## 9. elasticsearch、kibana——搜索

## 10. RabbitMQ——消息队列

## 11. actuator——服务监控，监控检查、审计、统计和监控

## 12. log4j2.xml——日志系统

## 13. tx-lcn——分布式事务

## 14. Swagger——API接口文档

## 15. MySQL——数据库

## 16. fastdfs——分布式文件系统



# 三、微服务设计图

## 1. 前台服务（公开网络）

### 边缘服务

#### 1. 负载均衡

#### 2. 路由服务

#### 3. API 网关

#### 4. 安全、访问控制

#### 5. 监控、限流

## 2. 后台服务（私有网络）

### 微服务集群‘

#### 1. 消息队列系统

#### 2. 配置管理系统

#### 3. 监控系统

#### 4. 日志分析系统

#### 5. 服务发现/注册

#### 6. API 文档管理

![](%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AD%A6%E4%B9%A0.assets/20210528153255.png)

